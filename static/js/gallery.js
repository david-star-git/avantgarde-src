const categoryButtons=document.querySelectorAll(".category-btn");const galleryItems=document.querySelectorAll(".gallery-item");function layoutGallery(category,instant=false){const container=document.querySelector(".gallery-grid");const gap=16;const itemWidth=220;const itemHeight=180;const containerWidth=container.clientWidth;const columns=Math.max(1,Math.floor((containerWidth+gap)/(itemWidth+gap)),);const totalGridWidth=columns*itemWidth+(columns-1)*gap;const offsetX=Math.max(0,(containerWidth-totalGridWidth)/2);const columnHeights=new Array(columns).fill(0);let visibleIndex=0;galleryItems.forEach((item)=>{const shouldShow=category==="alle"||item.dataset.category===category;if(!shouldShow){item.classList.add("hidden");}});setTimeout(()=>{galleryItems.forEach((item,index)=>{const shouldShow=category==="alle"||item.dataset.category===category;if(!shouldShow)return;const col=visibleIndex%columns;const x=offsetX+col*(itemWidth+gap);const y=columnHeights[col];const maxX=containerWidth-itemWidth;const safeX=Math.min(x,maxX);item.style.transform=`translate(${safeX}px,${y}px)`;columnHeights[col]+=itemHeight+gap;if(instant){item.classList.remove("hidden");}else{setTimeout(()=>{item.classList.remove("hidden");},visibleIndex*40);}
visibleIndex++;});setTimeout(()=>{const newHeight=columnHeights.length?Math.max(...columnHeights):0;container.style.height=newHeight+"px";container.style.maxHeight="none";},instant?0:100,);},instant?0:400,);}
categoryButtons.forEach((btn)=>{btn.addEventListener("click",()=>{if(btn.classList.contains("active"))return;categoryButtons.forEach((b)=>b.classList.remove("active"));btn.classList.add("active");layoutGallery(btn.dataset.category);});});layoutGallery("alle",true);let resizeTimeout;window.addEventListener("resize",()=>{clearTimeout(resizeTimeout);resizeTimeout=setTimeout(()=>{const activeCategory=document.querySelector(".category-btn.active").dataset.category;layoutGallery(activeCategory,true);},150);});window.addEventListener("orientationchange",()=>{setTimeout(()=>{const activeCategory=document.querySelector(".category-btn.active").dataset.category;layoutGallery(activeCategory,true);},200);});const modal=document.getElementById("gallery-modal");const modalImg=document.getElementById("modal-img");const modalClose=document.querySelector(".modal-close");if(!modalClose){console.error("modal-close button not found! Check your HTML.");}
function openModal(src){document.body.style.overflow="hidden";const img=new Image();img.onload=()=>{modalImg.src=src;modalImg.style.transform="";modalImg.style.transition="";modal.classList.remove("hide");modal.style.display="flex";void modal.offsetHeight;modal.classList.add("show");if(modalClose){modalClose.style.setProperty("opacity","1","important");}
setTimeout(()=>{if(modalClose){const closeStyles=window.getComputedStyle(modalClose);}},100);};img.src=src;}
function closeModal(){document.body.style.overflow="";modal.classList.remove("show");modal.classList.add("hide");if(modalClose){modalClose.style.setProperty("opacity","0","important");}
setTimeout(()=>{if(modal.classList.contains("hide")){modal.style.display="none";modalImg.src="";}},500);}
galleryItems.forEach((item)=>{const img=item.querySelector("img");img.addEventListener("click",()=>openModal(img.src));});if(modalClose){modalClose.addEventListener("click",closeModal);}else{console.error("Cannot add click listener - modalClose is null");}
modal.addEventListener("click",(e)=>{if(e.target===modal)closeModal();});document.addEventListener("keydown",(e)=>{if(e.key==="Escape"&&modal.classList.contains("show")){closeModal();}});let startY=0;let currentY=0;let isDragging=false;function onDragStart(e){isDragging=true;startY=e.touches?e.touches[0].clientY:e.clientY;currentY=startY;modalImg.classList.add("dragging");if(e.touches)e.preventDefault();}
function onDragMove(e){if(!isDragging)return;currentY=e.touches?e.touches[0].clientY:e.clientY;const deltaY=currentY-startY;if(deltaY<=0){modalImg.style.transform=`translateY(${deltaY}px)`;}
if(e.touches)e.preventDefault();}
function onDragEnd(e){if(!isDragging)return;isDragging=false;const deltaY=currentY-startY;modalImg.classList.remove("dragging");if(deltaY<-15){modalImg.style.transition="transform 0.3s ease-out";modalImg.style.transform="translateY(-100vh)";setTimeout(()=>{closeModal();},300);}else{modalImg.style.transition="transform 0.3s ease-out";modalImg.style.transform="translateY(0)";}}
modalImg.addEventListener("touchstart",onDragStart,{passive:false});modalImg.addEventListener("touchmove",onDragMove,{passive:false});modalImg.addEventListener("touchend",onDragEnd,{passive:false});modalImg.addEventListener("mousedown",onDragStart);modalImg.addEventListener("mousemove",onDragMove);modalImg.addEventListener("mouseup",onDragEnd);modalImg.addEventListener("mouseleave",onDragEnd);