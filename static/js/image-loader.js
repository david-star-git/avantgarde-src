document.addEventListener("DOMContentLoaded",()=>{const imageCache=new Set();const lazyBgElements=document.querySelectorAll(".bg-lazy");lazyBgElements.forEach((el)=>{const dataSrc=el.getAttribute("data-src");if(dataSrc){loadImageTag(el,dataSrc);}else{loadBackgroundImage(el);}});function loadImageTag(el,dataSrc){if(imageCache.has(dataSrc)){el.src=dataSrc;el.classList.add("bg-loaded");return;}
const img=new Image();img.src=dataSrc;img.onload=()=>{el.src=dataSrc;el.classList.add("bg-loaded");imageCache.add(dataSrc);};img.onerror=()=>{console.warn(`Failed to load image:${dataSrc}`);el.src=dataSrc;};}
function loadBackgroundImage(el){const currentBg=getComputedStyle(el).backgroundImage;if(!currentBg||currentBg==="none")return;const urlMatch=currentBg.match(/url\(["']?(.+?)["']?\)/);if(!urlMatch)return;const lowResUrl=urlMatch[1];const highResUrl=lowResUrl.replace(/-lowres\.(jpg|jpeg|png|webp)/i,".$1");if(imageCache.has(highResUrl)){el.style.backgroundImage=`url('${highResUrl}')`;el.classList.add("bg-loaded");return;}
const img=new Image();img.src=highResUrl;img.onload=()=>{el.style.backgroundImage=`url('${highResUrl}')`;el.classList.add("bg-loaded");imageCache.add(highResUrl);};img.onerror=()=>{console.warn(`Failed to load high-res image:${highResUrl}`);};}});